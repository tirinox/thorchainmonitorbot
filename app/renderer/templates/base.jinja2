<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="renderer/static/css/common.css?r=3">

    {%- block extra_head %}
    {% endblock %}

    <style>
        /* add some adjustments based on template parameters */
        html, body {
            width: {{ _width }}px;
            height: {{ _height }}px;
        }

        .container {
            max-width: {{ _width }}px;
            max-height: {{ _height }}px;
        }

        {%- if debug %}
            body {
                outline: 1px darkcyan dashed;
            }
            div {
                outline: #083a34 1px dashed;
            }
        {% endif %}
    </style>
    <script src="renderer/static/js/chart.umd.min.js"></script>

</head>
<body class="">
<div class="container bg">

    {% block content %}
    {% endblock %}


    <footer>
        THORChain Infobot <span id="today-date"></span>
    </footer>

</div>

<script>
    const todayDate = document.querySelector('#today-date');
    const formatDate = (date) => {
        const pad = (num) => String(num).padStart(2, '0');

        const day = pad(date.getUTCDate());
        const month = pad(date.getUTCMonth() + 1); // Months are 0-based
        const year = date.getUTCFullYear();
        const hours = pad(date.getUTCHours());
        const minutes = pad(date.getUTCMinutes());

        return `${day}.${month}.${year} ${hours}:${minutes} UTC`;
    };
    todayDate.innerText = formatDate(new Date());

    {% if auto %}
        (function () {
            const CHECK_INTERVAL = 2000; // ms
            let lastContent = null;

            async function checkForChanges() {
                try {
                    const response = await fetch(location.href, {
                        cache: "no-store" // avoid caching
                    });
                    const text = await response.text();
                    if (!lastContent) {
                        lastContent = text;
                        console.log('1 last content');
                    } else {

                        if (text !== lastContent) {
                            console.log("Page changed, reloading...");
                            location.reload();
                        } else {
                            console.log("No change");
                        }
                    }
                } catch (err) {
                    console.error("Check failed:", err);
                }
            }

            checkForChanges();
            setInterval(checkForChanges, CHECK_INTERVAL);
        })();
    {% endif %}
</script>


</body>
</html>
